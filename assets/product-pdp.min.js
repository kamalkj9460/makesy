<<<<<<< HEAD
"use strict";function _typeof(e){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t,r=1;r<arguments.length;r++)t=null==arguments[r]?{}:arguments[r],r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))});return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */function e(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}function t(e,t,o,a){var i=t&&t.prototype instanceof n?t:n,l=Object.create(i.prototype),s=new u(a||[]);return l._invoke=function(e,t,n){var o="suspendedStart";return function(a,i){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===a)throw i;return y()}for(n.method=a,n.arg=i;;){var l=n.delegate;if(l){var s=d(l,n);if(s){if(s===k)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var c=r(e,t,n);if("normal"===c.type){if(o=n.done?"completed":"suspendedYield",c.arg===k)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o="completed",n.method="throw",n.arg=c.arg)}}}(e,o,s),l}function r(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function o(){}function a(){}function i(t){["next","throw","return"].forEach(function(r){e(t,r,function(e){return this._invoke(r,e)})})}function l(e,t){function n(o,a,i,l){var d=r(e[o],e,a);if("throw"!==d.type){var s=d.arg,c=s.value;return c&&"object"==_typeof(c)&&f.call(c,"__await")?t.resolve(c.__await).then(function(e){n("next",e,i,l)},function(e){n("throw",e,i,l)}):t.resolve(c).then(function(e){s.value=e,i(s)},function(e){return n("throw",e,i,l)})}l(d.arg)}var o;this._invoke=function(e,r){function a(){return new t(function(t,o){n(e,r,t,o)})}return o=o?o.then(a,a):a()}}function d(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=void 0,d(e,t),"throw"===t.method))return k;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var o=r(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,k;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,k):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,k)}function s(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function c(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function u(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(s,this),this.reset(!0)}function p(e){if(e){var t=e[P];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(f.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:y}}function y(){return{value:void 0,done:!0}}_regeneratorRuntime=function(){return m};var m={},h=Object.prototype,f=h.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},P=g.iterator||"@@iterator",v=g.asyncIterator||"@@asyncIterator",b=g.toStringTag||"@@toStringTag";try{e({},"")}catch(t){e=function(e,t,r){return e[t]=r}}m.wrap=t;var k={},x={};e(x,P,function(){return this});var _=Object.getPrototypeOf,w=_&&_(_(p([])));w&&w!==h&&f.call(w,P)&&(x=w);var D=a.prototype=n.prototype=Object.create(x);return o.prototype=a,e(D,"constructor",a),e(a,"constructor",o),o.displayName=e(a,b,"GeneratorFunction"),m.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},m.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,e(t,b,"GeneratorFunction")),t.prototype=Object.create(D),t},m.awrap=function(e){return{__await:e}},i(l.prototype),e(l.prototype,v,function(){return this}),m.AsyncIterator=l,m.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new l(t(e,r,n,o),a);return m.isGeneratorFunction(r)?i:i.next().then(function(e){return e.done?e.value:i.next()})},i(D),e(D,b,"Generator"),e(D,P,function(){return this}),e(D,"toString",function(){return"[object Generator]"}),m.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},m.values=p,u.prototype={constructor:u,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(c),!e)for(var t in this)"t"===t.charAt(0)&&f.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,n){return a.type="throw",a.arg=e,r.next=t,n&&(r.method="next",r.arg=void 0),!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;0<=n;--n){var o=this.tryEntries[n],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var l=f.call(o,"catchLoc"),d=f.call(o,"finallyLoc");if(l&&d){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(!l){if(!d)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}}},abrupt:function(e,t){for(var r,n=this.tryEntries.length-1;0<=n;--n)if(r=this.tryEntries[n],r.tryLoc<=this.prev&&f.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,k):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),k},finish:function(e){for(var t,r=this.tryEntries.length-1;0<=r;--r)if(t=this.tryEntries[r],t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),c(t),k},catch:function(e){for(var t,r=this.tryEntries.length-1;0<=r;--r)if(t=this.tryEntries[r],t.tryLoc===e){var n=t.completion;if("throw"===n.type){var o=n.arg;c(t)}return o}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:p(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),k}},m}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r,n=0;n<t.length;n++)r=t[n],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var l=e[a](i),d=l.value}catch(e){return void r(e)}l.done?t(d):Promise.resolve(d).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){function a(e){asyncGeneratorStep(l,n,o,a,i,"next",e)}function i(e){asyncGeneratorStep(l,n,o,a,i,"throw",e)}var l=e.apply(t,r);a(void 0)})}}function clearCart(){return _clearCart.apply(this,arguments)}function _clearCart(){return _clearCart=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r;return _regeneratorRuntime().wrap(function n(e){for(;1;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/cart/clear.js",{method:"POST"});case 3:return t=e.sent,e.next=6,t.json();case 6:if(r=e.sent,console.log("json:",r),!r.status){e.next=10;break}return e.abrupt("return",pdp_wicks.addMessage(r.description,!0,!0));case 10:updateCart(r),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),console.log("cart error:",e.t0);case 16:case"end":return e.stop();}},e,null,[[0,13]])})),_clearCart.apply(this,arguments)}function add_to_cart(e){return _add_to_cart.apply(this,arguments)}function _add_to_cart(){return _add_to_cart=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n;return _regeneratorRuntime().wrap(function o(t){for(;1;)switch(t.prev=t.next){case 0:return console.log("formData:",e),t.prev=1,t.next=4,fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});case 4:return r=t.sent,t.next=7,r.json();case 7:if(n=t.sent,console.log("json:",n),!n.status){t.next=11;break}return t.abrupt("return",pdp_wicks.addMessage(n.description,!0,!0));case 11:updateCart(n),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](1),console.log("cart error:",t.t0);case 17:case"end":return t.stop();}},t,null,[[1,14]])})),_add_to_cart.apply(this,arguments)}function updateCart(e){return _updateCart.apply(this,arguments)}function _updateCart(){return _updateCart=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n,o,a,i,l,d,s,c;return _regeneratorRuntime().wrap(function u(t){for(;1;)switch(t.prev=t.next){case 0:return r=document.querySelector("[data-action=\"open-drawer\"]"),n=document.querySelector("[data-action=\"open-drawer\"] .small"),t.next=4,fetch("/cart?view=drawer&timestamp="+Date.now(),{credentials:"same-origin",method:"GET"});case 4:return o=t.sent,t.next=7,o.text();case 7:a=t.sent,i=new DOMParser().parseFromString(a,"text/html").querySelectorAll("[data-line-item-quantity]"),l=Array.from(i).reduce(function(e,t){var r=+t.dataset.lineItemQuantity;return e+r},0),99<l?n.classList.add("small-many"):n.classList.remove("small-many"),n.textContent=l,d=document.querySelector(".Cart"),s=d.parentNode,c=new DOMParser().parseFromString(a,"text/html").querySelector(".Cart"),Array.from(c.querySelectorAll(".CartItem__Title.Heading a")).forEach(function(e){"you planted trees for earth day"===e.textContent&&(e.style.pointerEvents="none")}),s.replaceChild(c,d),r.click(),updateShippingPercent(e);case 19:case"end":return t.stop();}},t)})),_updateCart.apply(this,arguments)}function updateShippingPercent(e){var t=+(e.items[0].final_price*currentQuantity/100).toFixed(2),r=document.querySelector(".progress_percent"),n=document.querySelector(".text_progress"),o=+r.style.width.replace(/(\d+\.\d{2}|\d{0,2})(.+)/g,"$1"),a=o+t;return 100<=o||100<=a?(r.style.width=a+"%",n.textContent="You Qualify for Free Domestic Shipping"):void(r.style.width=a+"%",n.textContent="You are $"+(99-a).toFixed(2)+" away from Free Domestic Shipping")}var PDP=function(){function e(){_classCallCheck(this,e),this.thumbs=document.querySelector(".PDP_thumbs"),this.resizeObserver(),this.swatchers(),this.addEventListeners(),this.stickyCTA(),this.observeDocumentMutations(),this.popState(),this.onLoadChanges(),this.state={options:{},product_type:meta.product.type,wickPricings:{},quantity:null,browserBack:!1,madeBetter:{desc:made_better_desc,icons:made_better_icon}},console.log("PDP.PDP_elements:",e.PDP_elements)}return _createClass(e,[{key:"addEventListeners",value:function e(){var t=this;document.querySelector(".PDP__cart-submit").addEventListener("click",this.cartController.bind(this)),Array.from(document.querySelectorAll(".m-dropdown input, .Dialog_list input")).forEach(function(e){return e.addEventListener("input",t.updateOptionValues.bind(t))})}},{key:"positionThumbs",value:function t(){function r(e){var t=e.tagName;"IMG"===t&&Array.from(i.children).forEach(function(t){t.className&&(t.className=""),t.src===e.src&&(t.className="fade-in")})}var n=new DocumentFragment,o=document.querySelector(".PDP_thumbs"),a=o.querySelectorAll("img"),i=e.PDP_elements[2];a.forEach(function(e,t){var r=e.cloneNode(!0);r.style.position="absolute",r.style.top="0px",r.style.left="0px",n.appendChild(r)}),i.appendChild(n),o.onclick=function(t){r(t.target)}}},{key:"onLoadChanges",value:function t(e){var r=this,n=document.querySelector(".PDP_inventory"),o=document.querySelector("input[data-products-id]");if(n){var a=function t(e){return e.split(/(?=(?:\d{3})+(?:\.|$))/g).join(",")},i=n.textContent.replace(/([\d]+)/,a);n.textContent=i}this.positionThumbs(),!this.isWickProduct()&&o&&this.productAPI(o.dataset.productsId,function(e){console.log("product:",e),r.filterOptions(e.product.variants)})}},{key:"observeDocumentMutations",value:function e(){var t=this,r=function r(e){for(var n,o=e.length;o--;)n=e[o],n.addedNodes.length&&"BUTTON"==n.target.tagName&&n.addedNodes[0].addEventListener("input",t.updateOptionValues.bind(t))},n={subtree:!0,childList:!0};this.observer=new MutationObserver(r),this.observer.observe(document.querySelector(".PDP_product-form"),n)}},{key:"resizeObserver",value:function e(){var t=this,r=function r(e){if(!(490>=window.innerWidth)){var n=Array.from(t.thumbs.children).reduce(function(e,t){return e+(t.offsetHeight+20)},0),o=e[0].contentRect.height;t.thumbs.style.height=n<o?n+"px":o+"px"}};try{this.observer=new ResizeObserver(r),this.observer.observe(document.querySelector(".PDP_mainImage"))}catch(e){console.log("err:",e)}}},{key:"stickyCTA",value:function e(){function t(e,t){var n=e[0].isIntersecting,a=e[0].boundingClientRect.bottom>window.innerHeight;n||o||!a?o&&n&&(r.classList.remove("PDP-btn-sticky"),o=!1):(r.classList.add("PDP-btn-sticky"),o=!0)}var r=document.querySelector(".PDP__cart-submit"),n=document.querySelector(".m-dropdown-quantity"),o=!1,a={childList:!0},i=new IntersectionObserver(t,a);i.observe(n)}},{key:"popState",value:function e(){var t=this;window.addEventListener("popstate",function(r){t.state.browserBack=!0;var e=r.state;e?e.collection?t.updateWithCollection(e):t.updateWithProduct(e):location.reload()})}},{key:"updateProductContent",value:function n(t,r){var o=this;console.log("data:",t);var a=t.product||t;if(a){var i=a.variants,l=i[0].id.replace(/[^0-9]/g,""),d=a.images,s=window.location.href.replace(/(.+\/products\/)(.+)/,"$1".concat(a.handle));this.state.browserBack||history.pushState(t,"",s),e.PDP_elements.forEach(function(e){var t,n=e.classList[0];switch(n){case"breadcrumb":e.querySelector("#dv_rbd02").textContent=a.title;break;case"PDP_thumbs":var s=d.reduce(function(e,t,r){var n=t.width/t.height;if(1>n&&.7<n){var o=document.createElement("div");o.className="PDP_thumb showNewImg";var a=new Image;a.src=t.url,o.appendChild(a),e.push(o)}return e},[]);if(1==s.length)return e.replaceChildren.apply(e,[]);e.replaceChildren.apply(e,_toConsumableArray(s)),o.thumbs=document.querySelector(".PDP_thumbs");break;case"PDP_mainImage":var c=Array.from(e.children);c.forEach(function(e){"fade-in"===e.className?(e.classList.add("fade-in"),e.onload=function(t){this.classList.add("fade-in")},e.src=d[0].url):e.remove()}),o.positionThumbs();break;case"PDP_heading-title":e.textContent=a.title;break;case"wish-list-heart":e.setAttribute("data-product-id",l),e.className="wish-list-heart swym-button swym-add-to-wishlist-view-product product_".concat(l," swym-icon swym-heart swym-loaded disabled swym-added swym-adding");break;case"PDP_inventory":var u=a.totalInventory+"";e.style.visibility="visible",e.textContent=u.replace(/[^\d]/g,"").split(/(?=(?:\d{3})+(?:\.|$))/g).join(",")+" in stock";break;case"PDP_price":if(e.textContent="$"+(+a.priceRangeV2.minVariantPrice.amount).toFixed(2),!o.isWickProduct()){var p=Array.from(document.querySelectorAll(".variant-select input")),y=Array.from(document.querySelectorAll(".product-form-size label")),m=a.variants;p.length&&m.reduce(function(e,t){var r=t.id.replace(/[^0-9]/g,"");return e<y.length&&y[e].setAttribute("for",r),e||(p[e].setAttribute("data-variant-price",t.price),p[e].value=r,p[e].id="default"),e++,p[e].setAttribute("data-variant-price",t.price),p[e].value=r,p[e].id=r,e},0)}break;case"PDP_description":if(""===a.descriptionHtml)break;e.innerHTML=a.descriptionHtml;break;case"PDP_color":e.textContent="Color: "+r,document.querySelector("circle[style]").removeAttribute("style"),document.querySelector("[data-swatch-color=\"".concat(r,"\"] circle")).style.strokeDashoffset=0;break;case"PDP_bulk_message":e.style.transform=null;break;case"btn-dropdown-quantity":e.children[0].checked=!0;break;case"variant-select":e.children[0].checked=!0;break;case"PDP__cart-submit":if(0==a.totalInventory)return e.children[0].textContent="out of stock",e.setAttribute("disabled","");e.removeAttribute("disabled"),e.children[0].textContent="add to cart - $"+(+a.priceRangeV2.minVariantPrice.amount).toFixed(2),e.setAttribute("data-productid",l);break;case"PDP-more-information":var h=null===(t=a.more_information)||void 0===t?void 0:t.value;h&&(e.innerHTML="<p>"+h.split("<br>").join("</p><p>")+"</p>");break;case"PDP-made-better":var f=o.state.madeBetter;if(f){e.innerHTML="";for(var g=a.tags.length,P=function t(){var r=new RegExp(a.tags[g],"i"),n=f.icons.findIndex(function(e){return r.test(e)});if(-1!=n){var o=document.createElement("div");o.className="PDP-icon-content";var i="<a href=\"/pages/makesy-made-better\" target=\"_blank\">\n                                                <img  src=\"".concat(f.icons[n],"\"> \n                                            </a>\n                                            <p>").concat(f.desc[n],"</p>");o.innerHTML=i,e.appendChild(o)}};g--;)P()}}o.state.browserBack=!1})}}},{key:"swatchColorUpdate",value:function t(e){var r=this,n=e.swatchProductId,o=e.swatchColor;fetch("https://api.makesy.com/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n})}).then(function(e){return e.json()}).then(function(e){r.updateProductContent(e.data,o)})["catch"](function(e){return console.log("err: ",e)})}},{key:"swatchers",value:function e(){var t=this,r=document.querySelector(".PDP_swatches");r&&(r.onclick=function(r){"swatch_color-item"==r.target.className&&t.swatchColorUpdate(r.target.dataset)})}},{key:"saleFunc",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n,o,a;return _regeneratorRuntime().wrap(function i(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(console.log("formData:",e),r=document.querySelector("[data-vip]"),!r){t.next=16;break}return t.next=7,fetch("/cart.js?view=drawer&timestamp="+Date.now(),{credentials:"same-origin"});case 7:return n=t.sent,t.next=10,n.json();case 10:if(o=t.sent,a=o.items.some(function(e){return 42123741593754==e.id}),!a){t.next=14;break}return t.abrupt("return",add_to_cart(e));case 14:return e.items.push({id:42123741593754,quantity:1}),t.abrupt("return",add_to_cart(e));case 16:add_to_cart(e);case 17:case"end":return t.stop();}},t)}));return e}()},{key:"isWickProduct",value:function e(){return /wick/i.test(window.location.pathname)&&!/clip|candle-accessories|maker-tools/i.test(meta.product.type)}},{key:"processFormData",value:function e(t){var r=document.querySelector(".PDP__cart-submit"),n=r.dataset.bulkDiscounts,o=Array.from(document.querySelectorAll(".PDP_product-form input:checked")),a=o.find(function(e){return"0"==e.dataset.index&&e.dataset.productId});if(a)return this.addMessage("".concat(a.name),!0,!0);var i=2<o.length&&this.getPriceAndVariant().id,l=o.reduce(function(e,t){var a=t.dataset,l=t.value,d=t.name;if(console.log("name:",d),1==o.length){if(e.id=r.dataset.productVariantId,e.quantity=o[0].value,n){var s=JSON.parse(n);e.properties={_percent:s.percent,_quantity:s.quantity}}return e}var c=a.bulkDiscounts;if(c){var u=JSON.parse(c);e.properties={_percent:u.percent,_quantity:u.quantity},e.id=l}else"quantity"==d?e.quantity=l:i?(e.quantity=l,e.id=i):"selling_plan"==d?(e.selling_plan=l,e.id=r.dataset.productVariantId,console.log("obj.id:",e.id)):e.id=l;return e},{});return{items:[l]}}},{key:"cartController",value:function e(t){var r=this.isWickProduct()?this.processWickFormData(t.target):this.processFormData(t.target);return this.isSale?this.saleFunc(r):void add_to_cart(r)}}],[{key:"PDP_elements",get:function e(){return document.querySelectorAll(".breadcrumb, .PDP_thumbs, .PDP_mainImage, .PDP_heading-title, .wish-list-heart, .PDP_price, .PDP_inventory,.PDP_description, .PDP_color, .btn-dropdown-quantity, .variant-select, .PDP_bulk_message, .PDP__cart-submit, .PDP-more-information, .PDP-made-better")}}]),e}(),PDP_wicks=function(e){function t(){var e,n=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];if(_classCallCheck(this,t),e=r.call(this),e.isSale=n,e.toggleMenu(),e.bulk_message=document.querySelector(".PDP_bulk_message"),e.error_message=document.querySelector(".PDP_error_message"),e.flyout_el=document.querySelector(".Dialog__values"),e.dropDownRadios=document.querySelectorAll(".PDP-options button"),e.dialogInputs=document.querySelector(".Dialog_input"),e.submitBTN=document.querySelector(".PDP__cart-submit"),e.hasTopCollectionDropDown=document.querySelector(".product-form-collection"),e.isWickProduct()&&e.dialogInputs){var o,a,i,l,d=null===(o=document.querySelector("[data-collection-id]"))||void 0===o||null===(a=o.dataset)||void 0===a?void 0:a.collectionId;console.log("collectionID:",d);var s=null===(i=document.querySelector("[data-products-id]"))||void 0===i||null===(l=i.dataset)||void 0===l?void 0:l.productsId;d?e.collectionAPI(d):e.productAPI(s),history.replaceState(0,"",window.location.pathname);var c=document.querySelector(".Dialog_list");e.dropDownRadios.length&&c.addEventListener("mouseover",e.updateFlyOut.bind(_assertThisInitialized(e)))}return e}_inherits(t,e);var r=_createSuper(t);return _createClass(t,[{key:"processWickFormData",value:function e(){var t,r=Array.from(document.querySelectorAll(".PDP_product-form input:checked"));console.log("inputs:",r);var n=document.querySelector(".m-quantity-select:checked").value;if(3>=r.length){var o;return{items:[{id:(null===(o=document.querySelector(".wick-variant-select input:checked"))||void 0===o?void 0:o.value)||this.submitBTN.dataset.productVariantId,quantity:n}]}}var a=r.some(function(e){return"default"==e.id&&"Width"==e.name});if(a)return this.addMessage("Please select a width",!0,!0),!1;var i=null===(t=document.querySelector("#select-pack-size input:checked"))||void 0===t?void 0:t.value,l="100"!=i&&i?1:0,d=this.getPriceAndVariant().id.replace(/[^0-9]/g,"");console.log("variantId:",d);var s=r.reduce(function(e,t){var r=t.name.trim().toLowerCase();if("quantity"===r){var o={id:d,quantity:n,properties:l?{_percent:"10,15",_quantity:"10,50"}:null};return e.push(o),e}if("clips"===r){var a=t.value.split(",")[l];["true","Pre-Inserted"].includes(t.id)&&e.push({id:a,quantity:n}),"100"==i&&/custom-wick/i.test(meta.product.type)&&e.push({id:35935883853978,quantity:1})}return e},[]);return console.log("formData:",s),{items:s}}},{key:"updateWithCollection",value:function t(e){var r="undefined"==typeof this.state.products,n=e.products;if(this.state.options={},this.state.wickPricings={},this.state=_objectSpread(_objectSpread({},this.state),e),console.log("collection products:",n),console.log("this.hasTopCollectionDropDown:",this.hasTopCollectionDropDown),this.hasTopCollectionDropDown||this.dropDownRadios.length){var o=n[0].variants,a=_objectSpread(_objectSpread(_objectSpread({},n[0]),e),{},{title:e.title});return r?(this.filterFlyOutData(n),this.loadOptionDropDowns(o)):void(this.updateProductContent(a),this.loadOptionDropDowns(o),this.loadWickTypeDropDown(n))}}},{key:"updateWithProduct",value:function t(e){console.log("updatewithproduct",e);var r="undefined"==typeof this.state.flyout;return this.state=_objectSpread(_objectSpread(_objectSpread({},this.state),e),{},{quantity:"0"}),r&&this.dropDownRadios.length?(this.state.flyout=[e.product.fly_out.value],this.updateFlyOut(),this.loadOptionDropDowns(e.product.variants)):void(this.updateProductContent(e),this.loadOptionDropDowns(e.variants))}},{key:"updateWickProduct",value:function t(e){var r=e.id,n=e.title,o=e.name;if("product"===o&&(document.querySelector("[for=\"default\"]").textContent=n),!(2>=document.querySelectorAll("[name=\"".concat(o,"\"]")).length)){if("collection"===o)return this.collectionAPI(r);var a=this.state.products.find(function(e){return e.title===n});this.updateWithProduct(a)}}},{key:"updateFlyOut",value:function e(t){var r=this.state.flyout,n=null===t||void 0===t?void 0:t.target;if(n){var o=this.flyout_el.firstElementChild,a=n.getAttribute("index");if(r[a]){var i=document.createElement("div");i.innerHTML=r[a],this.flyout_el.replaceChild(i,o);var l=i.getBoundingClientRect().height+42+"px";this.flyout_el.style.height=l}}else{var d=document.createElement("div");d.innerHTML=r[0],this.flyout_el.appendChild(d);var s=d.getBoundingClientRect().height+42+"px";this.flyout_el.style.height=s}}},{key:"filterFlyOutData",value:function t(e){var r=e.map(function(e){return e.fly_out.value.replace(/<span>/,"<span class=\"bl-space\">")});this.state.flyout=r,this.updateFlyOut()}},{key:"filterOptions",value:function t(e){var r=this;return this.state.options={},this.state.wickPricings={},e.reduce(function(e,t,n){var o=t.title,a=t.id,i=t.price,l=t.selectedOptions;return r.state.options[o]=a.replace(/[^0-9]/g,""),r.state.wickPricings[n]=+i,l.reduce(function(e,t){var r=t.name,n=t.value,o="".concat(r);return e[o]?!e[o].includes(n)&&e[o].push(n):e[o]=[n],e},e),e},{})}},{key:"loadOptionDropDowns",value:function r(e,t){var n=this;if(console.log("data, callback:",e),!!this.dropDownRadios.length){var o=document.querySelectorAll(".PDP-options .menu-list"),a=document.getElementsByClassName("PDP_price")[0];Array.from(document.querySelectorAll(".PDP-options input, .PDP-options li")).forEach(function(e){return!e.checked&&e.remove()});var l=document.querySelectorAll(".PDP-options input:checked"),d=function t(e){var r,i=(null===(r=e.product)||void 0===r?void 0:r.variants)||e,d=i.reduce(function(e,t){var r=+(e.price||e),n=+t.price;return n<r&&(e=n),r});a.textContent="$"+d.toFixed(2);var s=n.filterOptions(i);console.log("this.state",n.state.options),n.dropDownRadios.forEach(function(e,t){var r=Object.keys(s)[t];l[t].title=r,l[t].value=s[r][0],l[t].id="default",s[r].forEach(function(n){var a=document.createElement("input");Object.assign(a,{type:"radio",id:n,name:r,title:n,value:n}),a.setAttribute("data-index",t),e.appendChild(a);var i=document.createElement("li");i.setAttribute("data-index",t);var l=document.createElement("label");l.setAttribute("for",n),l.textContent=n,i.appendChild(l),o[t].appendChild(i)})})};t?t(e,d):d(e)}}},{key:"loadWickTypeDropDown",value:function t(e){console.log("loadWickTypeDropDown products:",e);var r=document.querySelector(".product-form-size input"),n=document.querySelector(".Dialog_list");Array.from(n.querySelectorAll("li")).forEach(function(e){return e.remove()}),e.forEach(function(e,t){var o=e.id,a=e.variants,i=e.title,l=null===a||void 0===a?void 0:a[0].id;0==t&&(r.id="default",r.value=l,r.title="Select a wick type");var d=document.createElement("input");Object.assign(d,{className:"Dialog_input",type:"radio",id:o,name:"product",title:i,value:l});var s=document.createElement("li"),c=document.createElement("label");c.className="Dialog_label",c.setAttribute("for",o),c.textContent=i,s.append(d,c),n.appendChild(s)})}},{key:"getBulkDiscounts",value:function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,r=1<arguments.length?arguments[1]:void 0,n=r&&r.reduce(function(e,r){var n=r.dataset.bulkDiscounts;if(console.log("bulk_discounts:",n),!n)return e;var o=JSON.parse(n),a=o.percent,i=o.quantity,l=i.split(",").map(Number),d=a.split(",").map(Number),s=l.reduce(function(e,r,n){return r<=+t&&(e=n),e},0),c=0>l[s]-t?s+1:s;return e.index=c,e.percent=d,e.quantity=l,e},{});return 0!==Object.keys(n).length&&n}},{key:"addMessage",value:function n(e,t,r){return r?(this.error_message.style.transform=t?"translate(0px, 0px)":null,this.error_message.textContent=e):void(this.bulk_message.style.transform=t?"translate(0px, 0px)":null,this.bulk_message.textContent=e)}},{key:"bulkMessage",value:function t(e){if(this.isWickProduct()){var r,n=null===(r=document.querySelector("#select-pack-size input:checked"))||void 0===r?void 0:r.value;if(!n)return;var o="";if("100"==n)return this.addMessage("",!1,!1);if(10<e){var a=50-e;o=0>=a?"You qualify for 15% off 50 Packs of 1000":"You're ".concat(a," away from receiving 15% off for 50 Packs of 1000")}else{var i=10-e;o=0>=i?"You qualify for 10% off 10 Packs of 1000":"You're ".concat(i," away from receiving 10% off for 10 Packs of 1000")}this.addMessage(o,!0,!1)}else{var l=Array.from(document.querySelectorAll(".variant-select input:checked, .PDP__cart-submit")),d=this.getBulkDiscounts(e,l),s=this.state.checkedTitle||document.querySelector(".PDP__cart-submit").title;if(d){var c=d.index,u=d.percent,p=d.quantity,y=p[c]-e,m=0==y,h="";h=m?"You qualify for ".concat(u[c],"% off ").concat(s):isNaN(y)?"You qualify for ".concat(u[c-1],"% off ").concat(s):"Add ".concat(y," more for ").concat(u[c],"% off ").concat(s),this.addMessage(h,!0,!1)}}}},{key:"updateInventory",value:function t(e){var r=e.title,n=e.name,o=e.dataset,a=document.querySelector(".PDP_inventory"),i=+(null===o||void 0===o?void 0:o.stock)||0,l="continue"===(null===o||void 0===o?void 0:o.policy);if(0===i&&!l)return this.submitBTN.children[0].textContent="out of stock",this.submitBTN.setAttribute("disabled","");if((this.submitBTN.children[0].textContent=this.submitBTN.children[0].textContent.replace(/out of stock/,"add to cart"),this.submitBTN.removeAttribute("disabled"),!!a)&&(a.style.visibility=/case pack/i.test(r)?"hidden":"visible","Style"==n||"Size"==n)){if(0>=i)return a.textContent="";if(100>i)return a.textContent="less than 100 in stock";a.textContent=(null===o||void 0===o?void 0:o.stock.split(/(?=(?:\d{3})+(?:\.|$))/g).join(","))+" in stock"}}},{key:"getPriceAndVariant",value:function e(){var t=Array.from(document.querySelectorAll(".options-select input:checked"));if(console.log("sizeInputs:",t),!t.length){var r=document.querySelector("[data-product-variant-id]").dataset,n=r.productVariantId,o=r.variantPrice;return{id:+n,price:+o}}var a=0;if(this.isWickProduct()){var i=document.querySelector(".PDP-clips input:checked"),l="100"===t[2].value?0:1;a=+i.dataset.variantPrice.split(",")[l]||0}var d=this.state.wickPricings,s=t.map(function(e){return e.value}).join(" / "),c=Object.keys(this.state.options).findIndex(function(e){return e==s}),u=a+d[c],p=this.state.options[s];return console.log("id:",p),console.log("price:",u),{id:p,price:u}}},{key:"updatePrice",value:function e(){var t=0;if(this.isWickProduct())t=this.getPriceAndVariant().price;else{var r,n,o,a,i,l;t=+(null===(r=document.querySelector(".variant-select input:checked, .wick-variant-select input:checked"))||void 0===r||null===(n=r.dataset)||void 0===n||null===(o=n.variantPrice)||void 0===o?void 0:o.replace(/,/,""))||+(null===(a=document.querySelector(".PDP__cart-submit"))||void 0===a||null===(i=a.dataset)||void 0===i||null===(l=i.variantPrice)||void 0===l?void 0:l.replace(/,/,""))}var d=+document.querySelector(".m-dropdown-quantity input:checked").value,s=document.querySelector(".PDP_price"),c=document.querySelector(".PDP__cart-submit span"),u=c.textContent.split("-")[0],p=d*t;console.log("newPrice:",p),s.textContent="$"+p.toFixed(2),c.textContent=u+" - $"+p.toFixed(2)}},{key:"checkOptionCombinations",value:function t(e){var r=this,n=Array.from(document.querySelectorAll("input[data-index=\"1\"]"));if(!(2>=n.length)){var o=Array.from(document.querySelectorAll("li[data-index=\"1\"]")),a=n.map(function(t){return"".concat(e," / ").concat(t.value)});console.log("nextSelection:",a);var i=a.reduce(function(e,t,n){var o=new RegExp(t,"i"),a=Object.keys(r.state.options).every(function(e){return!o.test(e)});return a?e.notFound.push(n):e.exists.push(n),e},{exists:[],notFound:[]});console.log("found:",i),i.exists.forEach(function(e,t){if(e&&(o[e-1].style=null,n[e].style=null),!t){var r=n[e].id;n[0].checked=!0,"default"!==r&&(n[0].value=n[e].id)}}),i.notFound.length&&i.notFound.forEach(function(e,t){e&&(o[e-1].style.display="none",n[e].style.display="none")})}}},{key:"updateOptionValues",value:function e(t){var r,n,o=t.target.name,a=null===(r=t.target)||void 0===r||null===(n=r.dataset)||void 0===n?void 0:n.index,i=t.target.value;console.log("value:",i);var l=t.target.title;if(["collection","product"].includes(o))this.updateWickProduct(t.target);else if(["0","1","2"].includes(a))"0"==a&&(this.addMessage("",!1,!0),this.checkOptionCombinations(i)),this.bulkMessage(this.state.quantity),this.updatePrice();else if("quantity"==o)this.addMessage("",!1,!0),this.state.quantity=i,this.updatePrice(),this.bulkMessage(i);else if("clips"==o)this.updatePrice();else{this.addMessage("",!1,!0),this.updateInventory(t.target);var d=t.target.dataset.bulkDiscounts;if(this.updatePrice(),!d)return this.bulk_message.style.transform=null;this.state.quantity&&(this.state.checkedTitle=l,this.bulkMessage(this.state.quantity))}}},{key:"productAPI",value:function r(e,t){var n=this;fetch("https://api.makesy.com/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then(function(e){return e.json()}).then(function(e){var r=e.data;if(!r)throw"Error at product api: in product-pdp.js";console.log("product res:",r),t?t(e.data):n.updateWithProduct(e.data)})["catch"](function(e){return console.log("err: ",e)})}},{key:"collectionAPI",value:function r(e,t){var n=this;console.log("id:",e),fetch("https://api.makesy.com/db-collections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then(function(e){return e.json()}).then(function(e){if(!e)throw"Error at collection api: in product-pdp.js";console.log("collection products res:",e),n.updateWithCollection(e)})["catch"](function(e){return console.log("err: ",e)})}},{key:"toggleMenu",value:function e(){var t=Array.from(document.getElementsByClassName("PDP-dropdown-toggle")),r="";t.forEach(function(e){e.addEventListener("click",function(t){function n(t){document.removeEventListener("click",n),r&&(r.style.transform=null,r="")}t.stopPropagation();var o=t.target,a=o.closest(".m-dropdown").getElementsByClassName("dropdown-menu-items")[0];if("BUTTON"!==o.tagName)return r="";if(!r)document.addEventListener("click",n),a.style.transform="translateY(0) scale(1)",r=a;else{if(r!==a)return a.style.transform="translateY(0) scale(1)",r.style.transform=null,r=a;r.style.transform=null,r=""}})})}}]),t}(PDP),pdp_wicks=new PDP_wicks(!0);
=======
"use strict";function _typeof(e){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t,r=1;r<arguments.length;r++)t=null==arguments[r]?{}:arguments[r],r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))});return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */function e(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}function t(e,t,o,a){var i=t&&t.prototype instanceof n?t:n,l=Object.create(i.prototype),s=new u(a||[]);return l._invoke=function(e,t,n){var o="suspendedStart";return function(a,i){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===a)throw i;return y()}for(n.method=a,n.arg=i;;){var l=n.delegate;if(l){var s=d(l,n);if(s){if(s===k)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var c=r(e,t,n);if("normal"===c.type){if(o=n.done?"completed":"suspendedYield",c.arg===k)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o="completed",n.method="throw",n.arg=c.arg)}}}(e,o,s),l}function r(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function o(){}function a(){}function i(t){["next","throw","return"].forEach(function(r){e(t,r,function(e){return this._invoke(r,e)})})}function l(e,t){function n(o,a,i,l){var d=r(e[o],e,a);if("throw"!==d.type){var s=d.arg,c=s.value;return c&&"object"==_typeof(c)&&f.call(c,"__await")?t.resolve(c.__await).then(function(e){n("next",e,i,l)},function(e){n("throw",e,i,l)}):t.resolve(c).then(function(e){s.value=e,i(s)},function(e){return n("throw",e,i,l)})}l(d.arg)}var o;this._invoke=function(e,r){function a(){return new t(function(t,o){n(e,r,t,o)})}return o=o?o.then(a,a):a()}}function d(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=void 0,d(e,t),"throw"===t.method))return k;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var o=r(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,k;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,k):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,k)}function s(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function c(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function u(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(s,this),this.reset(!0)}function p(e){if(e){var t=e[P];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(f.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:y}}function y(){return{value:void 0,done:!0}}_regeneratorRuntime=function(){return m};var m={},h=Object.prototype,f=h.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},P=g.iterator||"@@iterator",v=g.asyncIterator||"@@asyncIterator",b=g.toStringTag||"@@toStringTag";try{e({},"")}catch(t){e=function(e,t,r){return e[t]=r}}m.wrap=t;var k={},w={};e(w,P,function(){return this});var x=Object.getPrototypeOf,D=x&&x(x(p([])));D&&D!==h&&f.call(D,P)&&(w=D);var _=a.prototype=n.prototype=Object.create(w);return o.prototype=a,e(_,"constructor",a),e(a,"constructor",o),o.displayName=e(a,b,"GeneratorFunction"),m.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},m.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,e(t,b,"GeneratorFunction")),t.prototype=Object.create(_),t},m.awrap=function(e){return{__await:e}},i(l.prototype),e(l.prototype,v,function(){return this}),m.AsyncIterator=l,m.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new l(t(e,r,n,o),a);return m.isGeneratorFunction(r)?i:i.next().then(function(e){return e.done?e.value:i.next()})},i(_),e(_,b,"Generator"),e(_,P,function(){return this}),e(_,"toString",function(){return"[object Generator]"}),m.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},m.values=p,u.prototype={constructor:u,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(c),!e)for(var t in this)"t"===t.charAt(0)&&f.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,n){return a.type="throw",a.arg=e,r.next=t,n&&(r.method="next",r.arg=void 0),!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;0<=n;--n){var o=this.tryEntries[n],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var l=f.call(o,"catchLoc"),d=f.call(o,"finallyLoc");if(l&&d){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(!l){if(!d)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}}},abrupt:function(e,t){for(var r,n=this.tryEntries.length-1;0<=n;--n)if(r=this.tryEntries[n],r.tryLoc<=this.prev&&f.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,k):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),k},finish:function(e){for(var t,r=this.tryEntries.length-1;0<=r;--r)if(t=this.tryEntries[r],t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),c(t),k},catch:function(e){for(var t,r=this.tryEntries.length-1;0<=r;--r)if(t=this.tryEntries[r],t.tryLoc===e){var n=t.completion;if("throw"===n.type){var o=n.arg;c(t)}return o}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:p(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),k}},m}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r,n=0;n<t.length;n++)r=t[n],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var l=e[a](i),d=l.value}catch(e){return void r(e)}l.done?t(d):Promise.resolve(d).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){function a(e){asyncGeneratorStep(l,n,o,a,i,"next",e)}function i(e){asyncGeneratorStep(l,n,o,a,i,"throw",e)}var l=e.apply(t,r);a(void 0)})}}function clearCart(){return _clearCart.apply(this,arguments)}function _clearCart(){return _clearCart=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r;return _regeneratorRuntime().wrap(function n(e){for(;1;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/cart/clear.js",{method:"POST"});case 3:return t=e.sent,e.next=6,t.json();case 6:if(r=e.sent,console.log("json:",r),!r.status){e.next=10;break}return e.abrupt("return",pdp_wicks.addMessage(r.description,!0,!0));case 10:updateCart(r),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),console.log("cart error:",e.t0);case 16:case"end":return e.stop();}},e,null,[[0,13]])})),_clearCart.apply(this,arguments)}function add_to_cart(e){return _add_to_cart.apply(this,arguments)}function _add_to_cart(){return _add_to_cart=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n;return _regeneratorRuntime().wrap(function o(t){for(;1;)switch(t.prev=t.next){case 0:return console.log("formData:",e),t.prev=1,t.next=4,fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});case 4:return r=t.sent,t.next=7,r.json();case 7:if(n=t.sent,console.log("json:",n),!n.status){t.next=11;break}return t.abrupt("return",pdp_wicks.addMessage(n.description,!0,!0));case 11:updateCart(n),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](1),console.log("cart error:",t.t0);case 17:case"end":return t.stop();}},t,null,[[1,14]])})),_add_to_cart.apply(this,arguments)}function updateCart(e){return _updateCart.apply(this,arguments)}function _updateCart(){return _updateCart=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n,o,a,i,l,d,s,c;return _regeneratorRuntime().wrap(function u(t){for(;1;)switch(t.prev=t.next){case 0:return r=document.querySelector("[data-action=\"open-drawer\"]"),n=document.querySelector("[data-action=\"open-drawer\"] .small"),t.next=4,fetch("/cart?view=drawer&timestamp="+Date.now(),{credentials:"same-origin",method:"GET"});case 4:return o=t.sent,t.next=7,o.text();case 7:a=t.sent,i=new DOMParser().parseFromString(a,"text/html").querySelectorAll("[data-line-item-quantity]"),l=Array.from(i).reduce(function(e,t){var r=+t.dataset.lineItemQuantity;return e+r},0),99<l?n.classList.add("small-many"):n.classList.remove("small-many"),n.textContent=l,d=document.querySelector(".Cart"),s=d.parentNode,c=new DOMParser().parseFromString(a,"text/html").querySelector(".Cart"),Array.from(c.querySelectorAll(".CartItem__Title.Heading a")).forEach(function(e){"you planted trees for earth day"===e.textContent&&(e.style.pointerEvents="none")}),s.replaceChild(c,d),r.click(),updateShippingPercent(e);case 19:case"end":return t.stop();}},t)})),_updateCart.apply(this,arguments)}function updateShippingPercent(e){var t=+(e.items[0].final_price*currentQuantity/100).toFixed(2),r=document.querySelector(".progress_percent"),n=document.querySelector(".text_progress"),o=+r.style.width.replace(/(\d+\.\d{2}|\d{0,2})(.+)/g,"$1"),a=o+t;return 100<=o||100<=a?(r.style.width=a+"%",n.textContent="You Qualify for Free Domestic Shipping"):void(r.style.width=a+"%",n.textContent="You are $"+(99-a).toFixed(2)+" away from Free Domestic Shipping")}var PDP=function(){function e(){_classCallCheck(this,e),this.thumbs=document.querySelector(".PDP_thumbs"),this.resizeObserver(),this.swatchers(),this.addEventListeners(),this.stickyCTA(),this.observeDocumentMutations(),this.popState(),this.onLoadChanges(),this.state={options:{},product_type:meta.product.type,wickPricings:{},quantity:null,browserBack:!1,madeBetter:{desc:made_better_desc,icons:made_better_icon}},console.log("PDP.PDP_elements:",e.PDP_elements)}return _createClass(e,[{key:"addEventListeners",value:function e(){var t=this;document.querySelector(".PDP__cart-submit").addEventListener("click",this.cartController.bind(this)),Array.from(document.querySelectorAll(".m-dropdown input, .Dialog_list input")).forEach(function(e){return e.addEventListener("input",t.updateOptionValues.bind(t))})}},{key:"positionThumbs",value:function t(){function r(e){var t=e.tagName;"IMG"===t&&Array.from(i.children).forEach(function(t){t.className&&(t.className=""),t.src===e.src&&(t.className="fade-in")})}var n=new DocumentFragment,o=document.querySelector(".PDP_thumbs"),a=o.querySelectorAll("img"),i=e.PDP_elements[2];a.forEach(function(e,t){var r=e.cloneNode(!0);r.style.position="absolute",r.style.top="0px",r.style.left="0px",n.appendChild(r)}),i.appendChild(n),o.onclick=function(t){r(t.target)}}},{key:"onLoadChanges",value:function t(e){var r=this,n=document.querySelector(".PDP_inventory"),o=document.querySelector("input[data-products-id]");if(n){var a=function t(e){return e.split(/(?=(?:\d{3})+(?:\.|$))/g).join(",")},i=n.textContent.replace(/([\d]+)/,a);n.textContent=i}this.positionThumbs(),!this.isWickProduct()&&o&&this.productAPI(o.dataset.productsId,function(e){console.log("product:",e),r.filterOptions(e.product.variants)})}},{key:"observeDocumentMutations",value:function e(){var t=this,r=function r(e){for(var n,o=e.length;o--;)n=e[o],n.addedNodes.length&&"BUTTON"==n.target.tagName&&n.addedNodes[0].addEventListener("input",t.updateOptionValues.bind(t))},n={subtree:!0,childList:!0};this.observer=new MutationObserver(r),this.observer.observe(document.querySelector(".PDP_product-form"),n)}},{key:"resizeObserver",value:function e(){var t=this,r=function r(e){if(!(490>=window.innerWidth)){var n=Array.from(t.thumbs.children).reduce(function(e,t){return e+(t.offsetHeight+20)},0),o=e[0].contentRect.height;t.thumbs.style.height=n<o?n+"px":o+"px"}};try{this.observer=new ResizeObserver(r),this.observer.observe(document.querySelector(".PDP_mainImage"))}catch(e){console.log("err:",e)}}},{key:"stickyCTA",value:function e(){function t(e,t){var n=e[0].isIntersecting,a=e[0].boundingClientRect.bottom>window.innerHeight;n||o||!a?o&&n&&(r.classList.remove("PDP-btn-sticky"),o=!1):(r.classList.add("PDP-btn-sticky"),o=!0)}var r=document.querySelector(".PDP__cart-submit"),n=document.querySelector(".m-dropdown-quantity"),o=!1,a={childList:!0},i=new IntersectionObserver(t,a);i.observe(n)}},{key:"popState",value:function e(){var t=this;window.addEventListener("popstate",function(r){t.state.browserBack=!0;var e=r.state;e?e.collection?t.updateWithCollection(e):t.updateWithProduct(e):location.reload()})}},{key:"updateProductContent",value:function n(t,r){var o=this;console.log("data:",t);var a=t.product||t;if(a){var i=a.variants,l=i[0].id.replace(/[^0-9]/g,""),d=a.images,s=window.location.href.replace(/(.+\/products\/)(.+)/,"$1".concat(a.handle));this.state.browserBack||history.pushState(t,"",s),e.PDP_elements.forEach(function(e){var t,n=e.classList[0];switch(n){case"breadcrumb":e.querySelector("#dv_rbd02").textContent=a.title;break;case"PDP_thumbs":var s=d.reduce(function(e,t,r){var n=t.width/t.height;if(1>n&&.7<n){var o=document.createElement("div");o.className="PDP_thumb showNewImg";var a=new Image;a.src=t.url,o.appendChild(a),e.push(o)}return e},[]);if(1==s.length)return e.replaceChildren.apply(e,[]);e.replaceChildren.apply(e,_toConsumableArray(s)),o.thumbs=document.querySelector(".PDP_thumbs");break;case"PDP_mainImage":var c=Array.from(e.children);c.forEach(function(e){"fade-in"===e.className?(e.classList.add("fade-in"),e.onload=function(t){this.classList.add("fade-in")},e.src=d[0].url):e.remove()}),o.positionThumbs();break;case"PDP_heading-title":e.textContent=a.title;break;case"wish-list-heart":e.setAttribute("data-product-id",l),e.className="wish-list-heart swym-button swym-add-to-wishlist-view-product product_".concat(l," swym-icon swym-heart swym-loaded disabled swym-added swym-adding");break;case"PDP_inventory":var u=a.totalInventory+"";e.style.visibility="visible",e.textContent=u.replace(/[^\d]/g,"").split(/(?=(?:\d{3})+(?:\.|$))/g).join(",")+" in stock";break;case"PDP_price":if(e.textContent="$"+(+a.priceRangeV2.minVariantPrice.amount).toFixed(2),!o.isWickProduct()){var p=Array.from(document.querySelectorAll(".variant-select input")),y=Array.from(document.querySelectorAll(".product-form-size label")),m=a.variants;p.length&&m.reduce(function(e,t){var r=t.id.replace(/[^0-9]/g,"");return e<y.length&&y[e].setAttribute("for",r),e||(p[e].setAttribute("data-variant-price",t.price),p[e].value=r,p[e].id="default"),e++,p[e].setAttribute("data-variant-price",t.price),p[e].value=r,p[e].id=r,e},0)}break;case"PDP_description":if(""===a.descriptionHtml)break;e.innerHTML=a.descriptionHtml;break;case"PDP_color":e.textContent="Color: "+r,document.querySelector("circle[style]").removeAttribute("style"),document.querySelector("[data-swatch-color=\"".concat(r,"\"] circle")).style.strokeDashoffset=0;break;case"PDP_bulk_message":e.style.transform=null;break;case"btn-dropdown-quantity":e.children[0].checked=!0;break;case"variant-select":e.children[0].checked=!0;break;case"PDP__cart-submit":if(0==a.totalInventory)return e.children[0].textContent="out of stock",e.setAttribute("disabled","");e.removeAttribute("disabled"),e.children[0].textContent="add to cart - $"+(+a.priceRangeV2.minVariantPrice.amount).toFixed(2),e.setAttribute("data-productid",l);break;case"PDP-more-information":var h=null===(t=a.more_information)||void 0===t?void 0:t.value;h&&(e.innerHTML="<p>"+h.split("<br>").join("</p><p>")+"</p>");break;case"PDP-made-better":var f=o.state.madeBetter;if(f){e.innerHTML="";for(var g=a.tags.length,P=function t(){var r=new RegExp(a.tags[g],"i"),n=f.icons.findIndex(function(e){return r.test(e)});if(-1!=n){var o=document.createElement("div");o.className="PDP-icon-content";var i="<a href=\"/pages/makesy-made-better\" target=\"_blank\">\n                                                <img  src=\"".concat(f.icons[n],"\"> \n                                            </a>\n                                            <p>").concat(f.desc[n],"</p>");o.innerHTML=i,e.appendChild(o)}};g--;)P()}}o.state.browserBack=!1})}}},{key:"swatchColorUpdate",value:function t(e){var r=this,n=e.swatchProductId,o=e.swatchColor;fetch("https://api.makesy.com/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n})}).then(function(e){return e.json()}).then(function(e){r.updateProductContent(e.data,o)})["catch"](function(e){return console.log("err: ",e)})}},{key:"swatchers",value:function e(){var t=this,r=document.querySelector(".PDP_swatches");r&&(r.onclick=function(r){"swatch_color-item"==r.target.className&&t.swatchColorUpdate(r.target.dataset)})}},{key:"saleFunc",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n,o,a;return _regeneratorRuntime().wrap(function i(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(console.log("formData:",e),r=document.querySelector("[data-vip]"),!r){t.next=16;break}return t.next=7,fetch("/cart.js?view=drawer&timestamp="+Date.now(),{credentials:"same-origin"});case 7:return n=t.sent,t.next=10,n.json();case 10:if(o=t.sent,a=o.items.some(function(e){return 42123741593754==e.id}),!a){t.next=14;break}return t.abrupt("return",add_to_cart(e));case 14:return e.items.push({id:42123741593754,quantity:1}),t.abrupt("return",add_to_cart(e));case 16:add_to_cart(e);case 17:case"end":return t.stop();}},t)}));return e}()},{key:"isWickProduct",value:function e(){return /wick/i.test(window.location.pathname)&&!/clip|candle-accessories|maker-tools/i.test(meta.product.type)}},{key:"processFormData",value:function e(t){var r=document.querySelector(".PDP__cart-submit"),n=r.dataset.bulkDiscounts,o=Array.from(document.querySelectorAll(".PDP_product-form input:checked")),a=o.find(function(e){return"0"==e.dataset.index&&e.dataset.productId});if(a)return this.addMessage("".concat(a.name),!0,!0);var i=2<o.length&&this.getPriceAndVariant().id,l=o.reduce(function(e,t){var a=t.dataset,l=t.value,d=t.name;if(1==o.length){if(e.id=r.dataset.productVariantId,e.quantity=o[0].value,n){var s=JSON.parse(n);e.properties={_percent:s.percent,_quantity:s.quantity}}return e}var c=a.bulkDiscounts;if(c){var u=JSON.parse(c);e.properties={_percent:u.percent,_quantity:u.quantity},e.id=l}else"quantity"==d?e.quantity=l:i?(e.quantity=l,e.id=i):e.id=l;return e},{});return{items:[l]}}},{key:"cartController",value:function e(t){var r=this.isWickProduct()?this.processWickFormData(t.target):this.processFormData(t.target);return this.isSale?this.saleFunc(r):void add_to_cart(r)}}],[{key:"PDP_elements",get:function e(){return document.querySelectorAll(".breadcrumb, .PDP_thumbs, .PDP_mainImage, .PDP_heading-title, .wish-list-heart, .PDP_price, .PDP_inventory,.PDP_description, .PDP_color, .btn-dropdown-quantity, .variant-select, .PDP_bulk_message, .PDP__cart-submit, .PDP-more-information, .PDP-made-better")}}]),e}(),PDP_wicks=function(e){function t(){var e,n=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];if(_classCallCheck(this,t),e=r.call(this),e.isSale=n,e.toggleMenu(),e.bulk_message=document.querySelector(".PDP_bulk_message"),e.error_message=document.querySelector(".PDP_error_message"),e.flyout_el=document.querySelector(".Dialog__values"),e.dropDownRadios=document.querySelectorAll(".PDP-options button"),e.dialogInputs=document.querySelector(".Dialog_input"),e.submitBTN=document.querySelector(".PDP__cart-submit"),e.hasTopCollectionDropDown=document.querySelector(".product-form-collection"),e.isWickProduct()&&e.dialogInputs){var o,a,i,l,d=null===(o=document.querySelector("[data-collection-id]"))||void 0===o||null===(a=o.dataset)||void 0===a?void 0:a.collectionId;console.log("collectionID:",d);var s=null===(i=document.querySelector("[data-products-id]"))||void 0===i||null===(l=i.dataset)||void 0===l?void 0:l.productsId;d?e.collectionAPI(d):e.productAPI(s),history.replaceState(0,"",window.location.pathname);var c=document.querySelector(".Dialog_list");e.dropDownRadios.length&&c.addEventListener("mouseover",e.updateFlyOut.bind(_assertThisInitialized(e)))}return e}_inherits(t,e);var r=_createSuper(t);return _createClass(t,[{key:"processWickFormData",value:function e(){var t,r=Array.from(document.querySelectorAll(".PDP_product-form input:checked"));console.log("inputs:",r);var n=document.querySelector(".m-quantity-select:checked").value;if(3>=r.length){var o,a;return console.log(null===(o=document.querySelector(".wick-variant-select input:checked"))||void 0===o?void 0:o.value),{items:[{id:(null===(a=document.querySelector(".wick-variant-select input:checked"))||void 0===a?void 0:a.value)||this.submitBTN.dataset.productVariantId,quantity:n}]}}var i=r.some(function(e){return"default"==e.id&&"Width"==e.name});if(console.log("widthNotSelected:",i),i)return this.addMessage("Please select a width",!0,!0),!1;var l=null===(t=document.querySelector("#select-pack-size input:checked"))||void 0===t?void 0:t.value,d="100"!=l&&l?1:0,s=this.getPriceAndVariant().id.replace(/[^0-9]/g,"");console.log("variantId:",s);var c=r.reduce(function(e,t){var r=t.name.trim().toLowerCase();if("quantity"===r){var o={id:s,quantity:n,properties:d?{_percent:"10,15",_quantity:"10,50"}:null};return e.push(o),e}if("clips"===r){var a=t.value.split(",")[d];["true","Pre-Inserted"].includes(t.id)&&e.push({id:a,quantity:n}),"100"==l&&/custom-wick/i.test(meta.product.type)&&e.push({id:35935883853978,quantity:1})}return e},[]);return console.log("formData:",c),{items:c}}},{key:"updateWithCollection",value:function t(e){var r="undefined"==typeof this.state.products,n=e.products;if(this.state.options={},this.state.wickPricings={},this.state=_objectSpread(_objectSpread({},this.state),e),console.log("collection products:",n),console.log("this.hasTopCollectionDropDown:",this.hasTopCollectionDropDown),this.hasTopCollectionDropDown||this.dropDownRadios.length){var o=n[0].variants,a=_objectSpread(_objectSpread(_objectSpread({},n[0]),e),{},{title:e.title});return r?(this.filterFlyOutData(n),this.loadOptionDropDowns(o)):void(this.updateProductContent(a),this.loadOptionDropDowns(o),this.loadWickTypeDropDown(n))}}},{key:"updateWithProduct",value:function t(e){console.log("updatewithproduct",e);var r="undefined"==typeof this.state.flyout;return this.state=_objectSpread(_objectSpread(_objectSpread({},this.state),e),{},{quantity:"0"}),r&&this.dropDownRadios.length?(this.state.flyout=[e.product.fly_out.value],this.updateFlyOut(),this.loadOptionDropDowns(e.product.variants)):void(this.updateProductContent(e),this.loadOptionDropDowns(e.variants))}},{key:"updateWickProduct",value:function t(e){var r=e.id,n=e.title,o=e.name;if("product"===o&&(document.querySelector("[for=\"default\"]").textContent=n),!(2>=document.querySelectorAll("[name=\"".concat(o,"\"]")).length)){if("collection"===o)return this.collectionAPI(r);var a=this.state.products.find(function(e){return e.title===n});this.updateWithProduct(a)}}},{key:"updateFlyOut",value:function e(t){var r=this.state.flyout,n=null===t||void 0===t?void 0:t.target;if(n){var o=this.flyout_el.firstElementChild,a=n.getAttribute("index");if(r[a]){var i=document.createElement("div");i.innerHTML=r[a],this.flyout_el.replaceChild(i,o);var l=i.getBoundingClientRect().height+42+"px";this.flyout_el.style.height=l}}else{var d=document.createElement("div");d.innerHTML=r[0],this.flyout_el.appendChild(d);var s=d.getBoundingClientRect().height+42+"px";this.flyout_el.style.height=s}}},{key:"filterFlyOutData",value:function t(e){var r=e.map(function(e){return e.fly_out.value.replace(/<span>/,"<span class=\"bl-space\">")});this.state.flyout=r,this.updateFlyOut()}},{key:"filterOptions",value:function t(e){var r=this;return this.state.options={},this.state.wickPricings={},e.reduce(function(e,t,n){var o=t.title,a=t.id,i=t.price,l=t.selectedOptions;return r.state.options[o]=a.replace(/[^0-9]/g,""),r.state.wickPricings[n]=+i,l.reduce(function(e,t){var r=t.name,n=t.value,o="".concat(r);return e[o]?!e[o].includes(n)&&e[o].push(n):e[o]=[n],e},e),e},{})}},{key:"loadOptionDropDowns",value:function r(e,t){var n=this;if(console.log("data, callback:",e),!!this.dropDownRadios.length){var o=document.querySelectorAll(".PDP-options .menu-list"),a=document.getElementsByClassName("PDP_price")[0];Array.from(document.querySelectorAll(".PDP-options input, .PDP-options li")).forEach(function(e){return!e.checked&&e.remove()});var l=document.querySelectorAll(".PDP-options input:checked"),d=function t(e){var r,i=(null===(r=e.product)||void 0===r?void 0:r.variants)||e,d=i.reduce(function(e,t){var r=+(e.price||e),n=+t.price;return n<r&&(e=n),r});a.textContent="$"+d.toFixed(2);var s=n.filterOptions(i);console.log("this.state",n.state.options),n.dropDownRadios.forEach(function(e,t){var r=Object.keys(s)[t];l[t].title=r,l[t].value=s[r][0],l[t].id="default",s[r].forEach(function(n){var a=document.createElement("input");Object.assign(a,{type:"radio",id:n,name:r,title:n,value:n}),a.setAttribute("data-index",t),e.appendChild(a);var i=document.createElement("li");i.setAttribute("data-index",t);var l=document.createElement("label");l.setAttribute("for",n),l.textContent=n,i.appendChild(l),o[t].appendChild(i)})})};t?t(e,d):d(e)}}},{key:"loadWickTypeDropDown",value:function t(e){console.log("loadWickTypeDropDown products:",e);var r=document.querySelector(".product-form-size input"),n=document.querySelector(".Dialog_list");Array.from(n.querySelectorAll("li")).forEach(function(e){return e.remove()}),e.forEach(function(e,t){var o=e.id,a=e.variants,i=e.title,l=null===a||void 0===a?void 0:a[0].id;0==t&&(r.id="default",r.value=l,r.title="Select a wick type");var d=document.createElement("input");Object.assign(d,{className:"Dialog_input",type:"radio",id:o,name:"product",title:i,value:l});var s=document.createElement("li"),c=document.createElement("label");c.className="Dialog_label",c.setAttribute("for",o),c.textContent=i,s.append(d,c),n.appendChild(s)})}},{key:"getBulkDiscounts",value:function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,r=1<arguments.length?arguments[1]:void 0,n=r&&r.reduce(function(e,r){var n=r.dataset.bulkDiscounts;if(console.log("bulk_discounts:",n),!n)return e;var o=JSON.parse(n),a=o.percent,i=o.quantity,l=i.split(",").map(Number),d=a.split(",").map(Number),s=l.reduce(function(e,r,n){return r<=+t&&(e=n),e},0),c=0>l[s]-t?s+1:s;return e.index=c,e.percent=d,e.quantity=l,e},{});return 0!==Object.keys(n).length&&n}},{key:"addMessage",value:function n(e,t,r){return r?(this.error_message.style.transform=t?"translate(0px, 0px)":null,this.error_message.textContent=e):void(this.bulk_message.style.transform=t?"translate(0px, 0px)":null,this.bulk_message.textContent=e)}},{key:"bulkMessage",value:function t(e){if(this.isWickProduct()){var r,n=null===(r=document.querySelector("#select-pack-size input:checked"))||void 0===r?void 0:r.value;if(!n)return;var o="";if("100"==n)return this.addMessage("",!1,!1);if(10<e){var a=50-e;o=0>=a?"You qualify for 15% off 50 Packs of 1000":"You're ".concat(a," away from receiving 15% off for 50 Packs of 1000")}else{var i=10-e;o=0>=i?"You qualify for 10% off 10 Packs of 1000":"You're ".concat(i," away from receiving 10% off for 10 Packs of 1000")}this.addMessage(o,!0,!1)}else{var l=Array.from(document.querySelectorAll(".variant-select input:checked, .PDP__cart-submit")),d=this.getBulkDiscounts(e,l),s=this.state.checkedTitle||document.querySelector(".PDP__cart-submit").title;if(d){var c=d.index,u=d.percent,p=d.quantity,y=p[c]-e,m=0==y,h="";h=m?"You qualify for ".concat(u[c],"% off ").concat(s):isNaN(y)?"You qualify for ".concat(u[c-1],"% off ").concat(s):"Add ".concat(y," more for ").concat(u[c],"% off ").concat(s),this.addMessage(h,!0,!1)}}}},{key:"updateInventory",value:function t(e){var r=e.title,n=e.name,o=e.dataset,a=document.querySelector(".PDP_inventory"),i=+(null===o||void 0===o?void 0:o.stock)||0,l="continue"===(null===o||void 0===o?void 0:o.policy);if(0===i&&!l)return this.submitBTN.children[0].textContent="out of stock",this.submitBTN.setAttribute("disabled","");if((this.submitBTN.children[0].textContent=this.submitBTN.children[0].textContent.replace(/out of stock/,"add to cart"),this.submitBTN.removeAttribute("disabled"),!!a)&&(a.style.visibility=/case pack/i.test(r)?"hidden":"visible","Style"==n||"Size"==n)){if(0>=i)return a.textContent="";if(100>i)return a.textContent="less than 100 in stock";a.textContent=(null===o||void 0===o?void 0:o.stock.split(/(?=(?:\d{3})+(?:\.|$))/g).join(","))+" in stock"}}},{key:"getPriceAndVariant",value:function e(){var t=Array.from(document.querySelectorAll(".options-select input:checked"));if(console.log("sizeInputs:",t),!t.length){var r=document.querySelector("[data-product-variant-id]").dataset,n=r.productVariantId,o=r.variantPrice;return{id:+n,price:+o}}var a=0;if(this.isWickProduct()){var i=document.querySelector(".PDP-clips input:checked"),l="100"===t[2].value?0:1;a=+i.dataset.variantPrice.split(",")[l]||0}var d=this.state.wickPricings,s=t.map(function(e){return e.value}).join(" / "),c=Object.keys(this.state.options).findIndex(function(e){return e==s}),u=a+d[c],p=this.state.options[s];return console.log("id:",p),console.log("price:",u),{id:p,price:u}}},{key:"updatePrice",value:function e(){var t=0;if(this.isWickProduct())t=this.getPriceAndVariant().price;else{var r,n,o,a,i,l;t=+(null===(r=document.querySelector(".variant-select input:checked, .wick-variant-select input:checked"))||void 0===r||null===(n=r.dataset)||void 0===n||null===(o=n.variantPrice)||void 0===o?void 0:o.replace(/,/,""))||+(null===(a=document.querySelector(".PDP__cart-submit"))||void 0===a||null===(i=a.dataset)||void 0===i||null===(l=i.variantPrice)||void 0===l?void 0:l.replace(/,/,""))}var d=+document.querySelector(".m-dropdown-quantity input:checked").value,s=document.querySelector(".PDP_price"),c=document.querySelector(".PDP__cart-submit span"),u=c.textContent.split("-")[0],p=d*t;console.log("newPrice:",p),s.textContent="$"+p.toFixed(2),c.textContent=u+" - $"+p.toFixed(2)}},{key:"checkOptionCombinations",value:function t(e){var r=this,n=Array.from(document.querySelectorAll("input[data-index=\"1\"]"));if(!(2>=n.length)){var o=Array.from(document.querySelectorAll("li[data-index=\"1\"]")),a=n.map(function(t){return"".concat(e," / ").concat(t.value)});console.log("nextSelection:",a);var i=a.reduce(function(e,t,n){var o=new RegExp(t,"i"),a=Object.keys(r.state.options).every(function(e){return!o.test(e)});return a?e.notFound.push(n):e.exists.push(n),e},{exists:[],notFound:[]});console.log("found:",i),i.exists.forEach(function(e,t){if(e&&(o[e-1].style=null,n[e].style=null),!t){var r=n[e].id;n[0].checked=!0,"default"!==r&&(n[0].value=n[e].id)}}),i.notFound.length&&i.notFound.forEach(function(e,t){e&&(o[e-1].style.display="none",n[e].style.display="none")})}}},{key:"updateOptionValues",value:function e(t){var r,n,o=t.target.name,a=null===(r=t.target)||void 0===r||null===(n=r.dataset)||void 0===n?void 0:n.index,i=t.target.value;console.log("value:",i);var l=t.target.title;if(["collection","product"].includes(o))this.updateWickProduct(t.target);else if(["0","1","2"].includes(a))"0"==a&&(this.addMessage("",!1,!0),this.checkOptionCombinations(i)),this.bulkMessage(this.state.quantity),this.updatePrice();else if("quantity"==o)this.addMessage("",!1,!0),this.state.quantity=i,this.updatePrice(),this.bulkMessage(i);else if("clips"==o)this.updatePrice();else{this.addMessage("",!1,!0),this.updateInventory(t.target);var d=t.target.dataset.bulkDiscounts;if(this.updatePrice(),!d)return this.bulk_message.style.transform=null;this.state.quantity&&(this.state.checkedTitle=l,this.bulkMessage(this.state.quantity))}}},{key:"productAPI",value:function r(e,t){var n=this;fetch("https://api.makesy.com/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then(function(e){return e.json()}).then(function(e){var r=e.data;if(!r)throw"Error at product api: in product-pdp.js";console.log("product res:",r),t?t(e.data):n.updateWithProduct(e.data)})["catch"](function(e){return console.log("err: ",e)})}},{key:"collectionAPI",value:function r(e,t){var n=this;console.log("id:",e),fetch("https://api.makesy.com/db-collections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then(function(e){return e.json()}).then(function(e){if(!e)throw"Error at collection api: in product-pdp.js";console.log("collection products res:",e),n.updateWithCollection(e)})["catch"](function(e){return console.log("err: ",e)})}},{key:"toggleMenu",value:function e(){var t=Array.from(document.getElementsByClassName("PDP-dropdown-toggle")),r="";t.forEach(function(e){e.addEventListener("click",function(t){function n(t){document.removeEventListener("click",n),r&&(r.style.transform=null,r="")}t.stopPropagation();var o=t.target,a=o.closest(".m-dropdown").getElementsByClassName("dropdown-menu-items")[0];if("BUTTON"!==o.tagName)return r="";if(!r)document.addEventListener("click",n),a.style.transform="translateY(0) scale(1)",r=a;else{if(r!==a)return a.style.transform="translateY(0) scale(1)",r.style.transform=null,r=a;r.style.transform=null,r=""}})})}}]),t}(PDP),pdp_wicks=new PDP_wicks(!1);
>>>>>>> master
